---
title: "🎓SSRF of Axios|CVE-2024-39338"
desc: "Axios allows SSRF via unexpected behavior where requests for path relative URLs get processed as protocol relative URLs"
tags: "Vuln"
updateTime: "2024-12-04 16:37"
outline: deep
---

# SSRF of Axios|CVE-2024-39338

## Info of CVE

- `Axios 1.7.2` allows `SSRF` via unexpected behavior where requests for path relative URLs get processed as protocol relative URLs

- Affected Version: 1.3.2 ~ 1.7.4

## Example Vulnerable Code

```javascript
const axios = require('axios');

this.axios = axios.create({
  baseURL: 'https://userapi.example.com',
});

//userId = '12345';
userId = '/google.com'

this.axios.get(`/${userId}`).then(function (response) {
  console.log(`config.baseURL:  ${response.config.baseURL}`);
  console.log(`config.method:   ${response.config.method}`);
  console.log(`config.url:      ${response.config.url}`);
  console.log(`res.responseUrl: ${response.request.res.responseUrl}`);
});
```

## Analyze

### Debug

用VSCode对Node.js进行debug调试，分析漏洞发生逻辑。发现问题主要出现在解析baseURL和url后生成具体访问的url这一环节

![Parsed, Point of Mistake](https://oss.kiracoon.top/pic/RE_CVE-2024-39338-2024-12-04-16-10-17.jpg)

由于`Axios`采用对`baseurl`和后面附加的`url`相结合的解析过程，会存在拼接问题。进行动态路由的访问时，path可控会导致拼接出现`//<path>`的绝对路径形式，在受影响版本中会导致使用`Axios`的后端抛弃baseurl直接访问拼接后的绝对路径，受`SSRF`攻击影响

### Fix

从pr记录能看到有前后两种修复，第一种是直接改变了校验，取消了对`//`绝对路径协议的支持，这显然不是很符合需求，并且对正确使用者也是破坏性更新

最后真正使用的修复选择是第二种，识别运行环境，只有在运行在浏览器环境中对`//`做出识别

![Way of Fix](https://oss.kiracoon.top/pic/RE_CVE-2024-39338-2024-12-04-14-00-51.png)

修复后再次使用example测试，非浏览器环境，undefine to TypeError

![After Fix](https://oss.kiracoon.top/pic/RE_CVE-2024-39338.png)

### Summery

该问题是由特性更新引入的拼接逻辑问题，警惕由动态路由拼接带来的可能存在的绝对路径访问

---
**Reference**

<LinkCard desc='fix(sec): CVE-2024-39338 (#6539)' link='https://github.com/axios/axios/pull/6543/' />

<LinkCard desc="Server-Side Request Forgery Vulnerability in Axios (CVE-2024-39338)" link="https://jeffhacks.com/advisories/2024/06/24/CVE-2024-39338.html" />