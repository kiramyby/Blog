---
title: "ğŸ“SSRF of Axios|CVE-2024-39338"
desc: "Axios allows SSRF via unexpected behavior where requests for path relative URLs get processed as protocol relative URLs"
tags: "Vuln"
updateTime: "2024-12-04 16:37"
outline: deep
---

# SSRF of Axios|CVE-2024-39338

## Info of CVE

- `Axios 1.7.2` allows `SSRF` via unexpected behavior where requests for path relative URLs get processed as protocol relative URLs

- Affected Version: 1.3.2 ~ 1.7.4

## Example Vulnerable Code

```javascript
const axios = require('axios');

this.axios = axios.create({
  baseURL: 'https://userapi.example.com',
});

//userId = '12345';
userId = '/google.com'

this.axios.get(`/${userId}`).then(function (response) {
  console.log(`config.baseURL:  ${response.config.baseURL}`);
  console.log(`config.method:   ${response.config.method}`);
  console.log(`config.url:      ${response.config.url}`);
  console.log(`res.responseUrl: ${response.request.res.responseUrl}`);
});
```

## Analyze

### Debug

ç”¨VSCodeå¯¹Node.jsè¿›è¡Œdebugè°ƒè¯•ï¼Œåˆ†ææ¼æ´å‘ç”Ÿé€»è¾‘ã€‚å‘ç°é—®é¢˜ä¸»è¦å‡ºç°åœ¨è§£æbaseURLå’Œurlåç”Ÿæˆå…·ä½“è®¿é—®çš„urlè¿™ä¸€ç¯èŠ‚

![Parsed, Point of Mistake](https://oss.kiracoon.top/pic/RE_CVE-2024-39338-2024-12-04-16-10-17.jpg)

ç”±äº`Axios`é‡‡ç”¨å¯¹`baseurl`å’Œåé¢é™„åŠ çš„`url`ç›¸ç»“åˆçš„è§£æè¿‡ç¨‹ï¼Œä¼šå­˜åœ¨æ‹¼æ¥é—®é¢˜ã€‚è¿›è¡ŒåŠ¨æ€è·¯ç”±çš„è®¿é—®æ—¶ï¼Œpathå¯æ§ä¼šå¯¼è‡´æ‹¼æ¥å‡ºç°`//<path>`çš„ç»å¯¹è·¯å¾„å½¢å¼ï¼Œåœ¨å—å½±å“ç‰ˆæœ¬ä¸­ä¼šå¯¼è‡´ä½¿ç”¨`Axios`çš„åç«¯æŠ›å¼ƒbaseurlç›´æ¥è®¿é—®æ‹¼æ¥åçš„ç»å¯¹è·¯å¾„ï¼Œå—`SSRF`æ”»å‡»å½±å“

### Fix

ä»prè®°å½•èƒ½çœ‹åˆ°æœ‰å‰åä¸¤ç§ä¿®å¤ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥æ”¹å˜äº†æ ¡éªŒï¼Œå–æ¶ˆäº†å¯¹`//`ç»å¯¹è·¯å¾„åè®®çš„æ”¯æŒï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯å¾ˆç¬¦åˆéœ€æ±‚ï¼Œå¹¶ä¸”å¯¹æ­£ç¡®ä½¿ç”¨è€…ä¹Ÿæ˜¯ç ´åæ€§æ›´æ–°

æœ€åçœŸæ­£ä½¿ç”¨çš„ä¿®å¤é€‰æ‹©æ˜¯ç¬¬äºŒç§ï¼Œè¯†åˆ«è¿è¡Œç¯å¢ƒï¼Œåªæœ‰åœ¨è¿è¡Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å¯¹`//`åšå‡ºè¯†åˆ«

![Way of Fix](https://oss.kiracoon.top/pic/RE_CVE-2024-39338-2024-12-04-14-00-51.png)

ä¿®å¤åå†æ¬¡ä½¿ç”¨exampleæµ‹è¯•ï¼Œéæµè§ˆå™¨ç¯å¢ƒï¼Œundefine to TypeError

![After Fix](https://oss.kiracoon.top/pic/RE_CVE-2024-39338.png)

### Summery

è¯¥é—®é¢˜æ˜¯ç”±ç‰¹æ€§æ›´æ–°å¼•å…¥çš„æ‹¼æ¥é€»è¾‘é—®é¢˜ï¼Œè­¦æƒ•ç”±åŠ¨æ€è·¯ç”±æ‹¼æ¥å¸¦æ¥çš„å¯èƒ½å­˜åœ¨çš„ç»å¯¹è·¯å¾„è®¿é—®

---
**Reference**

<LinkCard desc='fix(sec): CVE-2024-39338 (#6539)' link='https://github.com/axios/axios/pull/6543/' />

<LinkCard desc="Server-Side Request Forgery Vulnerability in Axios (CVE-2024-39338)" link="https://jeffhacks.com/advisories/2024/06/24/CVE-2024-39338.html" />